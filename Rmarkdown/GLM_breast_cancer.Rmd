---
title: "GLM for por prediction of breast cancer malignancy"
author: "Alvaro Perona"
date: "2024-02-27"
output: html_document
---
```{r}
library(tidyverse)
library(ggplot2)
library(dplyr)
library(stringr)
```

Cargamos los datos de entreno y los datos de testeo
```{r}
raw_train=read.csv("./Data/Breast_Cancer_train.data",sep="_",header = F)
raw_test <- read.csv("./Data/Breast_Cancer_test_completo.csv")
```

Creamos una funcionq que saca la mediana de unos datos y otra que saque la lista de valores unicos que superen mas de x counts. Seran necesarias mas adelante
```{r}
moda=function(vector){
  return(as.numeric(names(which.max(table(unique(vector))))))
}

factores=function(vector){
  return(names(table(vector)[table(vector)>50]))
}

```

Creamos una funcion donde los NAs sean sustituidos por el valor promedio entero de esa columna y si hay un valor superior a 10, este sea divididdo entre 10 y redondeamos al numero entero hacia abajo, ya que suponemos que el ultimo numero sobra y se ha introducido por error.
```{r}


limpiar2=function(df){
  #Este for iterara por las columnas del data frame
  for (k in 2:length(colnames(df))){
    #Si la columna es numerica entra un for que itera por los datos de esa columna y cambia los datos si cumplen unas condiciones
    if (is.numeric(df[,k])==TRUE){
      for (r in 1:length(row.names(df))){
        #Si son NA los sustituye por la media de los valores de esa columna que no son NA.
        if (is.na(df[r,k])==1){
          df[r,k] <-round(mean(df[,k][is.na(df[,k])==0]))
        #Si son mayores de 10 asumimos que el segundo numero es erroneo. Dividimos por 10 y redondeamos.
        }else if(df[r,k]>10){
          print("mayor")
          df[r,k] <- round(df[r,k]/10)
        }
      }
    #Si en cambio esa columna es un factor habra codigio extra
    }else if(is.factor(df[,k])==TRUE){
      #Sacaremos los valores unicos que superen mas de X counts, que asumimos que son los niveles adecuados de ese factor
      levl=factores(df[,k])
      #transformamos en numerico la columna para poder operar
      df[,k] <- as.numeric(as.character(df[,k]))
      #El for itera por los valores de la columna
      for (r in 1:length(row.names(df))){
        if (is.na(df[r,k])==1){
          #Si es na lo sustituimos por la moda, ya que la media nos podria dar valores que no fuesen uno de los niveles
          df[r,k] <-moda(df[,k][is.na(df[,k])==0])
          #Si es mayor de 10 dividimos por 10 y redondeamos igual que en el otro for
        }else if(df[r,k]>10){
          print(2)
          df[r,k] <- round(df[r,k]/10)
          #Si es un valor que no corresponde a los niveles del factor lo sustituyo por la moda
        }else if (!(df[r,k] %in% levl)){
          print(3)
          df[r,k] = moda(df[,k][is.na(df[,k])==0])
        }
      }
      #lo vuelvo a condertir en factor
      df[,k] <- as.factor(df[,k])
      #le aÃ±ado los niveles
      levels(df[,k]) <- levl
    }
    
  }
    
  return(df)
}


```

Leemos los datasets de train y test y tranformamos las columnas a su tipo de dato correspondiente. En el caso del train tambien hay que eliminar el caracter h. Por ultimo les damos nombre a las columnas
```{r}
#Leemos los datos
raw_train=read.csv("./data/Breast_Cancer_train.data",sep="_",header = F)
raw_test <- read.csv("./data/Breast_Cancer_test_completo.csv")

#Arreglamos el train dataset
train_complete <- raw_train %>% mutate_all(~ str_replace_all(., "h", ""))
train_complete  <- as.data.frame(lapply(train_complete, as.numeric))
train_complete[,12] <- as.factor(train_complete[,12])
colnames(train_complete)=c("ID","clump_thickness","unif_cell_size","unif_cell_shape","Marg_adhes","Epith_cell_size","Bare_nucl","Bland_chrom","Normal_nucleoli","Mitoses","Group","class")
train_complete <- limpiar2(train_complete)

#Arreglamos el test dataset
test_complete <- as.data.frame(lapply(raw_test,as.numeric))
test_complete[,12] <- as.factor(test_complete[,12])
colnames(test_complete)=c("ID","clump_thickness","unif_cell_size","unif_cell_shape","Marg_adhes","Epith_cell_size","Bare_nucl","Bland_chrom","Normal_nucleoli","Mitoses","Group","class")
test_complete <- limpiar2(test_complete)
```



